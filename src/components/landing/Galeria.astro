---
import { GALLERY_IMAGES } from "../../data/galleryImages.js";
---

<section class="py-20 relative overflow-hidden">
    <div class="absolute inset-0 grid-bg opacity-30 pointer-events-none"></div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="text-center max-w-3xl mx-auto mb-16">
            <h1
                class="text-4xl md:text-5xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300"
            >
                Activity <span class="text-aimara-teal">Gallery</span>
            </h1>
            <p class="text-lg text-gray-600 dark:text-gray-400">
                Explore our captured moments: scholarships, presentations, and
                events that define our community.
            </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
            {
                GALLERY_IMAGES.map((image, index) => (
                    <div
                        class="group relative aspect-[4/3] rounded-2xl overflow-hidden glass-panel cursor-pointer gallery-item"
                        data-src={image.src}
                        data-index={index}
                    >
                        <div class="absolute inset-0 bg-gray-200 dark:bg-space-800 animate-pulse" />

                        <img
                            src={image.src}
                            alt={`Activity photo ${index + 1}`}
                            class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                            loading="lazy"
                            onload="this.previousElementSibling.style.display='none';"
                        />

                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-6">
                            <span class="text-white font-medium transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                                View full image
                            </span>
                        </div>
                    </div>
                ))
            }
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div
        id="lightbox"
        class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/90 backdrop-blur-sm opacity-0 transition-opacity duration-300"
        role="dialog"
        aria-modal="true"
    >
        <div class="absolute top-4 right-4 z-[110]">
            <button
                id="close-lightbox"
                class="text-white hover:text-aimara-teal transition-colors p-2 rounded-full hover:bg-white/10"
                aria-label="Close gallery"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-8 w-8"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <div
            class="relative w-full h-full max-w-5xl max-h-[90vh] mx-auto p-4 flex items-center justify-center"
        >
            <img
                id="lightbox-img"
                src=""
                alt="Full view"
                class="max-w-full max-h-full object-contain shadow-2xl rounded-lg scale-95 transition-transform duration-300"
            />
        </div>
    </div>
</section>

<script>
    document.addEventListener("astro:page-load", () => {
        const lightbox = document.getElementById("lightbox");
        const lightboxImg = document.getElementById("lightbox-img");
        const closeBtn = document.getElementById("close-lightbox");
        const items = document.querySelectorAll(".gallery-item");

        if (!lightbox || !lightboxImg || !closeBtn) return;

        function openLightbox(src) {
            lightbox.classList.remove("hidden");
            // Force reflow for transition
            void lightbox.offsetWidth;
            lightbox.classList.remove("opacity-0");
            lightboxImg.classList.remove("scale-95");
            lightboxImg.classList.add("scale-100");
            (lightboxImg as HTMLImageElement).src = src;
            document.body.style.overflow = "hidden";
        }

        function closeModal() {
            lightbox.classList.add("opacity-0");
            lightboxImg.classList.remove("scale-100");
            lightboxImg.classList.add("scale-95");
            setTimeout(() => {
                lightbox.classList.add("hidden");
                (lightboxImg as HTMLImageElement).src = "";
                document.body.style.overflow = "";
            }, 300);
        }

        items.forEach((item) => {
            item.addEventListener("click", () => {
                const src = item.getAttribute("data-src");
                if (src) openLightbox(src);
            });
        });

        closeBtn.addEventListener("click", closeModal);

        // Close on click outside
        lightbox.addEventListener("click", (e) => {
            const target = e.target as HTMLElement;
            if (target === lightbox || target.closest(".w-full") === target) {
                closeModal();
            }
        });

        // Close on Escape key
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && !lightbox.classList.contains("hidden")) {
                closeModal();
            }
        });
    });
</script>
